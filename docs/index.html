<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agent Machina - Compagnon Human Machine</title>
  <meta name="description" content="Assistant IA pour explorer le livre Human Machine de Jean de La Rochebrochard.">
  <meta property="og:title" content="Agent Machina">
  <meta property="og:description" content="Votre compagnon de lecture pour Human Machine">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“š</text></svg>">
  <script type="module" crossorigin src="/assets/index-UNUF3XFb.js"></script>
  <link rel="stylesheet" crossorigin href="/assets/index-CZ062KjL.css">
</head>
<body>
  <!-- Password Gate -->
  <div id="pw-gate" style="position:fixed;inset:0;background:linear-gradient(135deg,#0a0a0f 0%,#1a1a2e 50%,#0a0a0f 100%);z-index:9999;display:flex;align-items:center;justify-content:center;">
    <div style="text-align:center;padding:3rem;max-width:400px;">
      <div style="font-size:4rem;margin-bottom:1rem;">ğŸ“š</div>
      <h1 style="color:#fff;font-size:2.5rem;margin-bottom:0.5rem;font-weight:300;">Agent <span style="color:#6366f1;font-weight:600;">Machina</span></h1>
      <p style="color:#888;margin-bottom:2rem;font-size:1rem;">Votre compagnon de lecture pour<br><em style="color:#a5b4fc;">Human Machine</em> de Jean de La Rochebrochard</p>
      <div style="display:flex;gap:0.5rem;justify-content:center;">
        <input type="password" id="pw-input" placeholder="Mot de passe" style="padding:0.75rem 1rem;border-radius:8px;border:1px solid #333;background:#1a1a2e;color:#fff;font-size:1rem;width:200px;">
        <button id="pw-btn" style="padding:0.75rem 1.5rem;border-radius:8px;border:none;background:#6366f1;color:#fff;cursor:pointer;font-size:1rem;font-weight:500;transition:background 0.2s;" onmouseover="this.style.background='#4f46e5'" onmouseout="this.style.background='#6366f1'">Entrer</button>
      </div>
      <p style="color:#555;margin-top:2rem;font-size:0.8rem;">PropulsÃ© par <a href="https://www.algolia.com/doc/guides/ai/agent-studio/" target="_blank" style="color:#6366f1;text-decoration:none;">Algolia Agent Studio</a></p>
    </div>
  </div>

  <div id="app-wrapper" style="display:none;">
  <div class="app">
    <!-- Header -->
    <header>
      <div class="logo">Agent <span>Machina</span></div>
      <div class="search-box-container">
        <div id="searchbox"></div>
      </div>
      <div class="header-actions">
        <button class="header-btn" onclick="openFavoritesModal()">â­ Favoris <span id="fav-count"></span></button>
        <button class="header-btn" id="theme-toggle" onclick="toggleTheme()">â˜€ï¸</button>
        <a href="https://www.humanmachine.com/?ref=pln-machina" target="_blank" class="header-btn">ğŸ“– Livre</a>
        <a href="https://www.algolia.com/doc/guides/ai/agent-studio/" target="_blank" class="header-btn">ğŸ¤– Agent Studio</a>
      </div>
    </header>

    <!-- Left Panel - Explorer -->
    <aside class="explorer">
      <div class="facet-section">
        <div class="panel-title">ğŸ“š Sections</div>
        <div id="section-facet"></div>
      </div>

      <div class="facet-section">
        <div class="panel-title">ğŸ“‘ Chapitres</div>
        <div id="chapter-facet"></div>
      </div>

      <div class="facet-section">
        <div class="panel-title">ğŸ’¡ Concepts</div>
        <div id="concepts-facet"></div>
      </div>

      <div class="facet-section">
        <div class="panel-title">ğŸ“ Type</div>
        <div id="type-facet"></div>
      </div>
    </aside>

    <!-- Center Panel - Results -->
    <main class="results">
      <div class="results-header">
        <div id="stats"></div>
        <div id="clear"></div>
      </div>
      <div id="hits"></div>
      <div id="pagination"></div>
    </main>

    <!-- Right Panel - Chat (always open) -->
    <aside class="chat-panel">
      <div class="chat-header">
        <span class="chat-title">ğŸ’¬ Assistant</span>
        <button class="chat-clear-btn" onclick="clearChat()" title="Nouvelle conversation">ğŸ—‘ï¸</button>
      </div>
      <div id="chat"></div>
    </aside>
  </div>

  <!-- Footer -->
  <footer class="app-footer">
    <span>PropulsÃ© par <a href="https://www.algolia.com/doc/guides/ai/agent-studio/?ref=pln-machina" target="_blank">Algolia Agent Studio</a></span>
    <span>â€¢</span>
    <span>Livre: <a href="https://www.humanmachine.com/?ref=pln-machina" target="_blank">Human Machine</a> par Jean de La Rochebrochard</span>
    <span>â€¢</span>
    <span>Agent par <a href="https://me.nech.pl" target="_blank">PLN</a></span>
  </footer>

  <!-- Content Modal -->
  <div class="modal-overlay" id="modal" onclick="if(event.target === this) closeModal()">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-meta">
          <span class="hit-section" id="modal-section"></span>
          <span class="hit-page" id="modal-page"></span>
        </div>
        <button class="modal-close" onclick="closeModal()">&times;</button>
      </div>
      <div class="modal-title-section">
        <h2 class="modal-title" id="modal-title"></h2>
        <div class="modal-subtitle" id="modal-chapter"></div>
      </div>
      <div class="modal-body" id="modal-body"></div>
      <div class="modal-actions">
        <button class="modal-action-btn" onclick="askAboutQuote('explain')">
          <span class="action-icon">ğŸ’¡</span>
          <span class="action-label">Explique</span>
        </button>
        <button class="modal-action-btn" onclick="askAboutQuote('next')">
          <span class="action-icon">ğŸ§­</span>
          <span class="action-label">Ensuite</span>
        </button>
        <button class="modal-action-btn" onclick="askAboutQuote('apply')">
          <span class="action-icon">ğŸ¯</span>
          <span class="action-label">Appliquer</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Favorites Modal -->
  <div class="modal-overlay" id="favorites-modal" onclick="if(event.target === this) closeFavoritesModal()">
    <div class="modal favorites-modal">
      <div class="modal-header">
        <h3>â­ Mes Favoris</h3>
        <button class="modal-close" onclick="closeFavoritesModal()">&times;</button>
      </div>
      <div class="modal-body" id="favorites-list"></div>
    </div>
  </div>
  </div><!-- /app-wrapper -->

  <script>
    (function(){
      var g=document.getElementById('pw-gate'),w=document.getElementById('app-wrapper');
      var i=document.getElementById('pw-input'),b=document.getElementById('pw-btn');
      var isLocal = location.hostname==='localhost'||location.hostname==='127.0.0.1';
      var forceLock = new URLSearchParams(location.search).has('lock');
      var isAuth = localStorage.getItem('m_ok')==='1';
      function unlock(){g.style.display='none';w.style.display='block';}
      if(!forceLock && (isLocal||isAuth)){unlock();}
      function check(){if(i.value==='humanexmachina'){localStorage.setItem('m_ok','1');unlock();}}
      b.onclick=check;i.onkeydown=function(ev){if(ev.key==='Enter')check();};
    })();
  </script>
</body>
</html>
